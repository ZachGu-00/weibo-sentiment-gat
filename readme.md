# è¯é¢˜ææ€§æ¡ä»¶ä¸‹é’ˆå¯¹ç”¨æˆ·ç‰¹å¾å‘é‡è·å–

åŸºäºæ·±åº¦å­¦ä¹ çš„å¾®åšç”¨æˆ·ç½‘ç»œåˆ†æç³»ç»Ÿï¼Œé›†æˆæƒ…æ„Ÿåˆ†æã€å›¾ç‰¹å¾æå–å’Œè¾¹é¢„æµ‹åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [å®‰è£…è¯´æ˜](#å®‰è£…è¯´æ˜)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è¯¦ç»†ä½¿ç”¨è¯´æ˜](#è¯¦ç»†ä½¿ç”¨è¯´æ˜)
- [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
- [è¾“å‡ºç»“æœ](#è¾“å‡ºç»“æœ)
- [æ¨¡å‹æ¶æ„](#æ¨¡å‹æ¶æ„)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„å¾®åšç”¨æˆ·ç½‘ç»œåˆ†æç³»ç»Ÿï¼Œä¸»è¦ç”¨äºï¼š

- **æƒ…æ„Ÿåˆ†æ**ï¼šåŸºäºå¤šæ¨¡å‹èåˆçš„ä¸­æ–‡å¾®åšæ–‡æœ¬æƒ…æ„Ÿåˆ†æ
- **ç½‘ç»œå»ºæ¨¡**ï¼šç”¨æˆ·äº’åŠ¨å…³ç³»çš„å›¾ç»“æ„å»ºæ¨¡
- **é“¾æ¥é¢„æµ‹**ï¼šä½¿ç”¨å›¾æ³¨æ„åŠ›ç½‘ç»œï¼ˆGATï¼‰è¿›è¡Œç”¨æˆ·å…³ç³»é¢„æµ‹
- **ç‰¹å¾å·¥ç¨‹**ï¼šé›†æˆæ–‡æœ¬åµŒå…¥ã€æƒ…æ„Ÿç‰¹å¾å’Œç½‘ç»œæ‹“æ‰‘ç‰¹å¾

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. æƒ…æ„Ÿåˆ†ææ¨¡å—
- æ”¯æŒå¤šä¸ªé¢„è®­ç»ƒä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹
- åŠ æƒèåˆå¤šæ¨¡å‹é¢„æµ‹ç»“æœ
- è®¡ç®—æƒ…æ„Ÿåˆ†æ•°ã€æ³¢åŠ¨æ€§å’Œæ ‡ç­¾
- æ‰¹é‡å¤„ç†å’ŒGPUåŠ é€Ÿ

### 2. æ•°æ®é¢„å¤„ç†æ¨¡å—
- å›¾ç‰¹å¾æå–ï¼ˆPageRankã€åº¦ä¸­å¿ƒæ€§ç­‰ï¼‰
- æ–‡æœ¬åµŒå…¥é™ç»´ï¼ˆPCAï¼‰
- å¤šéš¾åº¦è´Ÿæ ·æœ¬é‡‡æ ·ç­–ç•¥
- æ•°æ®é›†åˆ’åˆ†å’Œæ ‡å‡†åŒ–

### 3. GATè®­ç»ƒæ¨¡å—
- æ”¹è¿›çš„å›¾æ³¨æ„åŠ›ç½‘ç»œæ¶æ„
- ä¸‰é˜¶æ®µæ¸è¿›å¼è®­ç»ƒç­–ç•¥
- æ—©åœæœºåˆ¶å’Œå­¦ä¹ ç‡è°ƒåº¦
- æ¨¡å‹æ£€æŸ¥ç‚¹ä¿å­˜

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
å¾®åšç½‘ç»œæ•°æ®
    â†“
æƒ…æ„Ÿåˆ†ææ¨¡å— â†’ æƒ…æ„Ÿç‰¹å¾æå–
    â†“
æ•°æ®é¢„å¤„ç†æ¨¡å— â†’ å›¾ç‰¹å¾å·¥ç¨‹ + è´Ÿæ ·æœ¬é‡‡æ ·
    â†“
GATè®­ç»ƒæ¨¡å— â†’ è¾¹é¢„æµ‹æ¨¡å‹è®­ç»ƒ
    â†“
ç»“æœè¾“å‡º â†’ æ¨¡å‹æ£€æŸ¥ç‚¹ + æ€§èƒ½æŠ¥å‘Š + ç”¨æˆ·åµŒå…¥
```

## ğŸš€ å®‰è£…è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- Python >= 3.8
- PyTorch >= 1.12.0
- CUDA (å¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿ)

### ä¾èµ–å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pip install torch torchvision torchaudio
pip install torch-geometric
pip install transformers
pip install scikit-learn pandas numpy tqdm networkx
```

### GPUç¯å¢ƒé…ç½®

```bash
# ä¸ºCUDA 11.8å®‰è£…PyTorch Geometric
pip install torch-geometric -f https://data.pyg.org/whl/torch-1.12.0+cu118.html
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from sentiment_analyzer import SentimentAnalyzer
from graph_preprocessor import main as preprocess_data
from gat_trainer import train_all_stages
from config import create_custom_config

# åˆ›å»ºé…ç½®
config = create_custom_config(
    raw_network_path="/path/to/your/weibo_network.pkl",
    output_dir="./results",
    epochs_baseline=100,
    learning_rate=0.003
)

# 1. æƒ…æ„Ÿåˆ†æ
analyzer = SentimentAnalyzer(config.paths.raw_network_path)
network, sentiment_df = analyzer.run_sentiment_analysis(
    results_csv_path="sentiment_results.csv"
)

# 2. æ•°æ®é¢„å¤„ç†
results, base_path, timestamp = preprocess_data()

# 3. GATè®­ç»ƒ
stage_files = {
    'baseline': f"presampled_baseline_{timestamp}.pkl",
    'medium': f"presampled_medium_{timestamp}.pkl", 
    'advanced': f"presampled_advanced_{timestamp}.pkl"
}

training_results = train_all_stages(
    base_data_path=base_path,
    stage_files=stage_files,
    output_dir=config.paths.training_output_dir
)
```

### 2. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# è¿è¡Œå®Œæ•´æµç¨‹
python main.py --config config.yaml --input data/network.pkl --output results/

# ä»…è¿è¡Œæƒ…æ„Ÿåˆ†æ
python sentiment_analyzer.py --input data/network.pkl --output results/sentiment/

# ä»…è¿è¡Œæ•°æ®é¢„å¤„ç†
python graph_preprocessor.py --input data/network.pkl --output results/preprocessing/

# ä»…è¿è¡ŒGATè®­ç»ƒ
python gat_trainer.py --base_data results/base_data.pkl --stage_files results/stages/ --output results/training/
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### æƒ…æ„Ÿåˆ†ææ¨¡å—

```python
from sentiment_analyzer import SentimentAnalyzer

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = SentimentAnalyzer("/path/to/network.pkl")

# è¿è¡Œæƒ…æ„Ÿåˆ†æ
network, results_df = analyzer.run_sentiment_analysis(
    output_path="updated_network.pkl",  # å¯é€‰ï¼šæŒ‡å®šè¾“å‡ºè·¯å¾„
    results_csv_path="sentiment_analysis.csv"  # å¯é€‰ï¼šä¿å­˜è¯¦ç»†ç»“æœ
)

# æŸ¥çœ‹æƒ…æ„Ÿåˆ†å¸ƒ
print(results_df['sentiment_label'].value_counts())
print(f"å¹³å‡æƒ…æ„Ÿåˆ†æ•°: {results_df['sentiment_score'].mean():.3f}")
```

**è¾“å‡ºç‰¹å¾**ï¼š
- `sentiment_score`: 0-1èŒƒå›´çš„æƒ…æ„Ÿåˆ†æ•°ï¼ˆ0=è´Ÿé¢ï¼Œ1=æ­£é¢ï¼‰
- `sentiment_label`: åˆ†ç±»æ ‡ç­¾ï¼ˆnegative/neutral/positiveï¼‰
- `sentiment_volatility`: æƒ…æ„Ÿæ³¢åŠ¨æ€§ï¼ˆæ ‡å‡†å·®ï¼‰

### æ•°æ®é¢„å¤„ç†æ¨¡å—

```python
from graph_preprocessor import load_and_prepare_data, create_presampled_datasets

# åŠ è½½å’Œå‡†å¤‡æ•°æ®
data = load_and_prepare_data("/path/to/network.pkl")

# åˆ›å»ºé¢„é‡‡æ ·æ•°æ®é›†
results, base_path, timestamp = create_presampled_datasets(
    data, output_dir="./preprocessing_output"
)
```

**è´Ÿæ ·æœ¬é‡‡æ ·ç­–ç•¥**ï¼š
- **Baseline**: çº¯éšæœºé‡‡æ ·
- **Medium**: 50%éšæœº + 30%ä¸­ç­‰éš¾åº¦ + 20%å›°éš¾
- **Advanced**: 20%éšæœº + 30%ä¸­ç­‰éš¾åº¦ + 50%å›°éš¾

### GATè®­ç»ƒæ¨¡å—

```python
from gat_trainer import train_single_stage, train_all_stages

# è®­ç»ƒå•ä¸ªé˜¶æ®µ
history, test_results, model_path, embeddings = train_single_stage(
    base_data_path="base_data.pkl",
    stage_data_path="stage_data.pkl", 
    output_dir="./training_output",
    stage_name="baseline"
)

# è®­ç»ƒæ‰€æœ‰é˜¶æ®µï¼ˆæ¨èï¼‰
results = train_all_stages(
    base_data_path="base_data.pkl",
    stage_files={
        'baseline': "baseline_stage.pkl",
        'medium': "medium_stage.pkl",
        'advanced': "advanced_stage.pkl"
    },
    output_dir="./training_output"
)
```

## âš™ï¸ é…ç½®æ–‡ä»¶

### åŸºæœ¬é…ç½®

```python
from config import Config, create_custom_config

# ä½¿ç”¨é»˜è®¤é…ç½®
config = Config()

# åˆ›å»ºè‡ªå®šä¹‰é…ç½®
config = create_custom_config(
    raw_network_path="/path/to/data.pkl",
    output_dir="./results",
    epochs_baseline=120,
    epochs_medium=150,
    epochs_advanced=180,
    learning_rate=0.003,
    batch_size=4096
)
```

### é…ç½®å‚æ•°è¯´æ˜

| å‚æ•°ç±»åˆ« | å‚æ•°å | é»˜è®¤å€¼ | è¯´æ˜ |
|---------|--------|--------|------|
| **æ¨¡å‹é…ç½®** | `hidden_channels` | 64 | GATéšè—å±‚ç»´åº¦ |
| | `out_channels` | 32 | è¾“å‡ºåµŒå…¥ç»´åº¦ |
| | `heads` | 4 | æ³¨æ„åŠ›å¤´æ•° |
| | `dropout` | 0.3 | Dropoutæ¯”ç‡ |
| **è®­ç»ƒé…ç½®** | `epochs` | 120/150/180 | å„é˜¶æ®µè®­ç»ƒè½®æ•° |
| | `learning_rate` | 0.003/0.002/0.001 | å„é˜¶æ®µå­¦ä¹ ç‡ |
| | `batch_size` | 4096 | è¾¹æ‰¹å¤„ç†å¤§å° |
| | `patience` | 25/30/35 | æ—©åœè€å¿ƒå€¼ |
| **æ•°æ®é…ç½®** | `train_ratio` | 0.7 | è®­ç»ƒé›†æ¯”ä¾‹ |
| | `val_ratio` | 0.15 | éªŒè¯é›†æ¯”ä¾‹ |
| | `test_ratio` | 0.15 | æµ‹è¯•é›†æ¯”ä¾‹ |

## ğŸ“Š è¾“å‡ºç»“æœ

### æ–‡ä»¶ç»“æ„

```
output/
â”œâ”€â”€ sentiment/
â”‚   â””â”€â”€ sentiment_analysis_results.csv     # æƒ…æ„Ÿåˆ†æç»“æœ
â”œâ”€â”€ preprocessing/
â”‚   â”œâ”€â”€ base_data_YYYYMMDD_HHMMSS.pkl     # åŸºç¡€å›¾æ•°æ®
â”‚   â”œâ”€â”€ presampled_baseline_YYYYMMDD_HHMMSS.pkl    # åŸºçº¿é‡‡æ ·æ•°æ®
â”‚   â”œâ”€â”€ presampled_medium_YYYYMMDD_HHMMSS.pkl      # ä¸­ç­‰é‡‡æ ·æ•°æ®
â”‚   â””â”€â”€ presampled_advanced_YYYYMMDD_HHMMSS.pkl    # é«˜çº§é‡‡æ ·æ•°æ®
â””â”€â”€ training/
    â”œâ”€â”€ baseline_training_history_YYYYMMDD_HHMMSS.csv    # è®­ç»ƒå†å²
    â”œâ”€â”€ baseline_test_results_YYYYMMDD_HHMMSS.csv        # æµ‹è¯•ç»“æœ
    â”œâ”€â”€ baseline_best_user_embeddings_YYYYMMDD_HHMMSS.csv # ç”¨æˆ·åµŒå…¥
    â”œâ”€â”€ baseline_best_model_YYYYMMDD_HHMMSS.pth          # æ¨¡å‹æ£€æŸ¥ç‚¹
    â””â”€â”€ all_stages_comparison_YYYYMMDD_HHMMSS.csv        # é˜¶æ®µå¯¹æ¯”
```

### æ€§èƒ½æŒ‡æ ‡

- **Accuracy**: åˆ†ç±»å‡†ç¡®ç‡
- **F1-Score**: F1åˆ†æ•°ï¼ˆä¸»è¦è¯„ä¼°æŒ‡æ ‡ï¼‰
- **Precision**: ç²¾ç¡®ç‡
- **Recall**: å¬å›ç‡
- **AUC**: ROCæ›²çº¿ä¸‹é¢ç§¯

### ç”¨æˆ·åµŒå…¥

è®­ç»ƒå®Œæˆåï¼Œæ¯ä¸ªç”¨æˆ·ä¼šå¾—åˆ°ä¸€ä¸ª32ç»´çš„å‘é‡è¡¨ç¤ºï¼ŒåŒ…å«ï¼š
- æ–‡æœ¬è¯­ä¹‰ä¿¡æ¯
- æƒ…æ„Ÿç‰¹å¾
- ç½‘ç»œæ‹“æ‰‘ç‰¹å¾
- ç”¨æˆ·è¡Œä¸ºæ¨¡å¼

## ğŸ§  æ¨¡å‹æ¶æ„

### GATç½‘ç»œç»“æ„

```
è¾“å…¥ç‰¹å¾ (132ç»´)
    â†“
GATå±‚1 (64Ã—4å¤´) + ELU + Dropout
    â†“  
GATå±‚2 (32Ã—1å¤´) + Dropout
    â†“
èŠ‚ç‚¹åµŒå…¥ (32ç»´)
    â†“
è¾¹é¢„æµ‹å™¨ (MLP + BatchNorm + Dropout)
    â†“
è¾¹å­˜åœ¨æ¦‚ç‡
```

### ç‰¹å¾ç»„æˆ

| ç‰¹å¾ç±»å‹ | ç»´åº¦ | æ¥æº |
|---------|------|------|
| PCAåµŒå…¥ | 128ç»´ | åŸå§‹æ–‡æœ¬åµŒå…¥é™ç»´ |
| æƒ…æ„Ÿåˆ†æ•° | 1ç»´ | å¤šæ¨¡å‹èåˆæƒ…æ„Ÿåˆ†æ |
| æƒ…æ„Ÿæ³¢åŠ¨æ€§ | 1ç»´ | æƒ…æ„Ÿåˆ†æ•°æ ‡å‡†å·® |
| PageRank | 1ç»´ | ç½‘ç»œä¸­å¿ƒæ€§æŒ‡æ ‡ |
| å…¥åº¦ | 1ç»´ | ç½‘ç»œæ‹“æ‰‘ç‰¹å¾ |

## âš¡ æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ä¼˜åŒ–
- æ‰¹å¤„ç†è®­ç»ƒå‡å°‘æ˜¾å­˜å ç”¨
- å®šæœŸæ¸…ç†GPUç¼“å­˜
- æ¢¯åº¦è£å‰ªé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸

### è®­ç»ƒä¼˜åŒ–
- å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥
- æ—©åœæœºåˆ¶é¿å…è¿‡æ‹Ÿåˆ
- æ¸è¿›å¼éš¾åº¦è®­ç»ƒ

### æ¨ç†ä¼˜åŒ–
```python
# æ¨¡å‹æ¨ç†ç¤ºä¾‹
model.eval()
with torch.no_grad():
    embeddings = model.encode(features, edge_index)
    predictions = model.decode(embeddings, test_edges)
```


### è°ƒè¯•æŠ€å·§

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æ£€æŸ¥æ•°æ®ç»´åº¦
print(f"Features shape: {features.shape}")
print(f"Edge index shape: {edge_index.shape}")

# éªŒè¯é…ç½®
from config import validate_config
errors = validate_config(config)
if errors:
    print("Configuration errors:", errors)
```



## ğŸ™ è‡´è°¢

- [PyTorch Geometric](https://pytorch-geometric.readthedocs.io/) - å›¾ç¥ç»ç½‘ç»œæ¡†æ¶
- [Transformers](https://huggingface.co/transformers/) - é¢„è®­ç»ƒæ¨¡å‹åº“
- [NetworkX](https://networkx.org/) - å›¾åˆ†æå·¥å…·åº“